# XDATA-JavaScript编码规范  

## 目录

[1. 概述](#1)  
  
[2. 总体命名规则](#2)  
  
	[2.1 基本命名规范](#2.1)  
  
		[2.1.1 命名方法](#2.1.1)  
  
		[2.1.2 命名规则](#2.1.2)  

		[2.1.3 其他规则](#2.1.3)  
  
	[2.2 特殊命名规则](#2.2)  
  
[3. 详细命名规则](#3)  
  
	[3.1 JavaScript文件](#3.1)  
  
	[3.2 布局](#3.2)  
  
	[3.3 变量](#3.3)  
  
	[3.4 语句](#3.4)  
  
		[3.4.1 简单语句](#3.4.1)  
  
		[3.4.2 复合语句](#3.4.2)  
  
		[3.4.3 语句标示](#3.4.3)  
  
		[3.4.4 其他事项](#3.4.4)  
  
	[3.5 函数](#3.5)  
  
[4. 注释](#4)  

	[4.1 注释内容](#4.1)  
  
	[4.2 注释规范](#4.2)  
  
[5. 其他注意事项](#5)  

## 1 概述<h2 id="1"></h2>

	一个优秀的程序员应该能够编写既能让电脑识别的代码又能让其他开发人员能够看懂并愿意去看的规范代码（规范代码就是结构清晰、可读性高、代码易于维护、不至于太过程化而杂乱无章），也就是书写可维护性的代码
	1. 基本概念
	可维护代码需要遵循以下规则
		* 可理解性：其他人可以接手代码并理解它的意图和一般途径而无须原开发人员的完整解释
		* 直观性：代码中的东西一看就能明白，不管其操作过程多么复杂
		* 可适应性：代码在重复使用时只要求更改传入的参数而不要求修改或重写代码以达到要求
		* 可扩展性：在代码架构上已考虑到未来允许对核心功能进行扩展
		* 可调试性：当有地方出错时，代码可以给予开发人员足够的信息来尽可能直接的确定问题所在，一种让代码变得可维护的简单途径就是形成一套JavaScript代码的书写约定
	2. 编写目的
    为前端开发人员的JavaScript代码编写提供参考依据和统一标准
  	3. 统一编程风格的意义
    	* 增加开发过程代码的强壮性、可读性、易维护性
    	* 减少有经验和无经验开发人员编程所需的脑力工作
    	* 为系统的良好维护打下好的基础
    	* 在项目范围内统一代码风格
    	* 通过人为以及自动的方式对最终软件应用质量标准
    	* 使新的开发人员快速适应项目氛围
    	* 支持项目资源的复用，允许开发人员从一个项目区域（或子项目团队）移动到另一个，而不需要重新适应新的子项目团队的氛围
    	* 一个优秀而且职业化的开发团队所必需的素质
  	4. 预期的读者和阅读建议
    本文档适用于前端开发人员在进行JavaScript代码编写时进行参考

## 2 总体命名规范<h2 id="2"></h2>

### 2.1 命名基本规范<h3 id="2.1"></h3>

#### 2.1.1 命名方法<h4 id="2.1.1"></h4>

  命名方法通常有以下几类
  1. camel命名法，形如
```javascript
var thisIsAnApple = '';
```
  2. pascal命名法，形如
```javascript
var ThisIsAnApple = '';
```
  3. 下划线命名法，形如
```javascript
var this_is_an_apple = '';
```
  4. 中划线命名法，形如
```javascript
var this-is-an-apple = '';
```
#### 2.1.2 命名规则<h4 id="2.1.2"></h4>

  根据不同类型的内容，必须严格采用如下的命名法
  1. 变量名，必须采用camel命名法，若变量名称由一个单词组成，必须为小写字母，例如：element、accountElement
  2. 参数名，必须采用camel命名法
  3. 函数名，必须采用camel命名法，使用动词或动词短语为其命名，例如：fGetValue()、fSetValue()
  4. 方法/属性，必须采用camel命名法
  5. 私有（保护）成员，必须以下划线开头，且必须采用camel命名法，例如：_element、_accountElement、_fSetValue()、_fGetValue()
  6. 常量名，必须使用全部大写的下划线命名法，例如：IS_DEBUG_ENABLED
  7. 类名，必须使用pascal命名法，例如Account、EventHandler
  8. 枚举名，必须使用pascal命名法
  9. 枚举的属性，必须使用全部大写的下划线命名法
  10. 命名空间，必须使用camel命名法

#### 2.1.3 其他规则<h4 id="2.1.3"></h4>

  1. 所有的变量名必须使用英文名称
  2. 命名同时还需要关注语义，例如：变量名应当使用名词，函数名应当用动宾短语，类名应当用名词等
  3. 常量必须在对象（类）或者枚举变量的前部声明（命名规则参考变量命名）
  4. 对于简写单词，不能使用大写名称作为变量名，例如：XML是简写单词，在使用其作为变量名时，要将其写为Xml
  5. 变量如果有较广的作用域，可以将其设计为一个类的成员，相对的如作用域较小或为私有变量则使用简洁的单词进行命名
  6. 公有变量必须清楚的表达自身的属性，因此应避免字义含糊不清，例如：应使用mouseEventHandler，而非mseEvtHdlr
  7. 类/构造函数可以使用扩展其基类的名称命名，这样可以正确、迅速的找到其基类的名称，例如：基类名称为EventHandler，扩展类名称为UIEventHandler、MouseEventHandler。基类可以在明确描述其属性的前提下，缩短其命名

### 2.2 特殊命名规范<h3 id="2.2"></h3>

  1. 术语："get/set"不要和一个字段相连，除非其被定义为私有变量
  2. 术语：compute作为变量名应为已经计算完成的变量，find作为变量名应为已经查找完成的变量，initialize或者init作为变量应为已经实例化（初始化）完成的类或者其它类型的变量
  3. 以is开头的变量名应设置为布尔值，同理其开头也可以为has、can、should或者b
  4. UI（用户界面）控制变量应在名称后加控制类型，例如：leftComboBox、TopScrollPane等
  5. 复数必须有其公共的名称约定
  6. 以num、count或者n开头的变量名约定为数字
  7. 以str或者s开头的变量名约定为字符串
  8. 以a开头的变量名约定为数组
  9. 以r开头的变量名约定为正则表达式
  10. 以o开头的变量名约定为表示以上未涉及到的其他对象
  11. 重复变量建议使用i、j、k、l、m、n（依次类推）等名称的变量
  12. 补充用语必须使用补充词，例如：get/set、add/remove、create/destroy、start/stop、insert/delete、begin/end等
  13. 能缩写的名称尽量使用缩写
  14. 避免使用有歧义的布尔变量名称，例如：isNotError、isNotFound等
  15. 方法如果返回一个类，则应该在名称上说明返回了什么，如果是一个过程，则应该说明做了什么

## 3 详细命名规范<h2 id="3"></h2>

### 3.1 JavaScript文件<h3 id="3.1"></h3>

  1. JavaScript程序应该独立保存在后缀为js的文件中
  2. JavaScript代码不应被包含在HTML文件中，除非这是段特定只属于此部分的代码，在HTML中的JavaScript代码会明显增加文件大小

### 3.2 布局<h3 id="3.2"></h3>

  1. 缩进使用4个空白符或1个TAB的制表位
  2. 表达式的缩进与变量声明应一致
  3. 代码折叠起来进行表示，感官上完全并且合乎逻辑
  4. 函数的参数应采用明确的缩进，缩进规则与其他块保持一致
  5. 避免每行超过80个字符，当一条语句一行写不下时，要考虑换行
  6. 在运算符号（最好是逗号）后换行，在运算符后换行可以减少因为复制粘贴产生的错误被分号掩盖的几率，下一行应该缩进8个空格或2个TAB符

### 3.3 变量<h3 id="3.3"></h3>

  1. 变量名应由26个大小写字母（a...z,A...Z），10个数字（0...9）和下划线中的元素组成，避免使用国际化字符（如中文）
  2. 变量必须在声明初始化以后才能使用，即便是null类型
  3. 变量不能产生歧义
  4. 相关的变量集应该放在同一代码块中，非相关的变量集不应该放在同一代码块中
  5. 变量应尽量保持最小的生存周期
  6. 杂项
    * 应尽量避免使用幻数（直接使用的常数），应使用常量代替
    * 浮点变量必须指明小数点后一位（即使是0）
    * 浮点变量必须指明实部（即使是0，用0.0进行表示）

### 3.4 语句<h3 id="3.4"></h3>

#### 3.4.1 简单语句<h4 id="3.4.1"></h4>

  1. 每一行最多包含一条语句，将分号（;）放到每条简单语句的结尾处
  2. 一个函数赋值或对象赋值也是赋值语句，应该以分号（;）结尾

#### 3.4.2 复合语句<h4 id="3.4.2"></h4>

  1. 被包含在{}（大括号）内的语句序列
  2. 被括起的语句必须多缩进4个空格
  3. 左大括号（{）应在符合语句起始行的结尾处，右大括号（}）应与左大括号（{）的那一行开头对齐
  4. 大括号应该在所有复合语句中使用，即使只有一条语句，当它们是控制结构的一部分时，比如一个if或for语句，这样做可以避免以后添加语句时造成的错误

#### 3.4.3 语句标示<h4 id="3.4.3"></h4>

  语句标示是可选的，只有以下语句必须被标示：while、do、for、switch
  1. return语句
    [强制]一条有返回值的return语句不要使用括号来括住返回值，如果返回表达式，则表达式应与return关键字在一行
  2. if语句：应如以下格式
```javascript
if (condition) {
  statements;
} else if (condition) {
  statements;
} else {
  statements;
}
```
  3. for语句：应如以下格式
```javascript
for (initialization; condition; update) {
  statements;
}
```
    for循环语句使用技巧，例如如下所示的for循环语句  
```javascript
for (i = 0; i < myArray.length; i++) {
  statements;
}
```
    [建议]每次判断i是否达到临界值时都要获取一遍myArray的length属性，这样做影响效率，可以用以下的形式
```javascript
for (i = 0, max = myArray.length; i < max; i++) {
  statements;
}
```
  4. while语句：应如以下格式
```javascript
while (condition) {
  statements;
}
```
  5. do语句：应如以下格式
    [强制]不像别的复合语句，do语句总是以分号（;）结尾
```javascript
do {
  statements;
} while (condition);
```
  6. switch语句：应如以下格式
    [强制]每个case相互对齐，每一组statements（除了default）都应以break、return或者throw结尾，不要让它顺次往下执行
```javascript
switch (expression) {
  case expression:
    statements;
  default:
    statements;
}
```
  7. try语句：应如以下格式
```javascript
try {
  statements;
} catch (variable) {
  statements;
} finally {
  statements;
}
```
  8. with语句：可以用来引用某个特定对象中已有的属性，但不能用来给对象添加属性，要给对象创建新的属性，必须明确地引用该对象
    [强制]在编写代码中尽量不要使用with语句  
  9. 空白，用空行来将逻辑相关的代码块分割开可以提高程序的可读性。空格应在以下情况时使用
    * 跟在左括号后面的关键字应被一个空格隔开，例如：while (condition) {}
    * 函数参数与左括号之间不应该有空格，这能帮助区分关键字和函数调用，每个参数之间应该用逗号+空格隔开
    * 所有二元操作符，除了点（.）、左括号和左方括号（[）之外，应用空格将其与操作数隔开
    * 一元操作符与其操作数之间不应该有空格，除非操作符是个单词，比如typeof
    * 每个控制部分，比如for语句中的分号（;）后面须跟一个空格
    * 每个逗号（,）后面须跟一个空格
  10. {}和[]
    * 使用{}代替new Object()，使用[]代替new Array()
    * 当成员是一组有序的数字时使用数组来保存数据，当成员名是无规律的字符串或其他时使用对象来保存数据
  11. 逗号操作符，避免使用逗号操作符，除非在特定的for语句的控制部分（不包括那些被用在对象定义，数组定义，var语句和参数列表中的逗号分隔符）

#### 3.4.4 其他事项<h4 id="3.4.4"></h4>

  1. 操作符建议使用空格隔开（包括三元操作符？：）
  2. 逗号（，）与之后的内容建议使用空白隔开，冒号（：）与之后的内容建议使用空白隔开
  3. 逻辑块之间使用空行，声明、建议等尽量对其，便于阅读
  4. 循环/重复变量的规范
    * 只有循环控制块的话，则必须使用for循环
    * 循环变量应该在循环开始前就被初始化，如使用for循环，则使用for语句初始化循环变量，例如：for(var i = 0; i < length; i++)
    * 可以使用do...while语句（但使用时要注意不要出现死循环）
    * 可以使用break和continue语句（但要注意二者的区别），应尽量避免使用continue语句，它很容易使程序的逻辑过程晦涩难懂
  5. 条件表达式
    * 应该尽量避免复杂的条件表达式，如有必要可以使用临时布尔量
    * 在使用if...else...进行条件判断时，经常发生的情况应该放在if后面的代码中，而另一种不常发生的情况应放在else后面的代码中
    * 应避免在条件表达式中加入块

### 3.5 函数<h3 id="3.5"></h3>

  1. 函数命名
    * 函数名与左括号之间不应该有空格，在右括号与开始程序体的左大括号之间应插入一个空格，函数程序体应缩进4个空格或1个TAB符，例如
```javascript
function outer(c, d) {
  var e = c * d;
  function inner(a, b) {
    return (e * a) + b;
  }
  return inner(0, 1);
}
```
    * 函数名的命名规则与变量命名一样，采用驼峰命名规则，首字母需要小写，约定以f开头，例如fGetValue()
    * 统一使用动词或者动词+名词形式，例如：fGetVersion()、fSubmitForm()、fInit()
    * 涉及返回逻辑值的函数可以使用is，has，contains等表示逻辑的词语代替动词，例如：fIsObject()、fHasClass()、fContainsElment()
    * 对象方法命名使用f+对象类名+动词+名词形式；例如：fnAddressGetEmail()
    * 某事件响应函数命名方式为f+触发事件对象名+事件名或者模块名，例如：fDivClick()，fAddressSubmitButtonClick()
  2. 函数方法常用的动词
| 方法名               | 注释          | 方法名              | 注释       |
| :----------------:  | :----------: | :-----------------: | :-------: |
| get/set             | 获取/设置     | add/remove          | 增加/删除  |
| create/destory      | 创建/移除     | start/stop          | 启动/停止  |
| open/close          | 打开/关闭     | read/write          | 读取/写入  |
| load/save           | 载入/保存     | create/destory      | 创建/销毁  |
| begin/end           | 开始/结束     | backup/restore      | 备份/恢复  |
| import/export       | 导入/导出     | split/merge         | 分割/合并  |
| inject/extract      | 注入/提取     | attach/detach       | 附着/脱离  |
| bind/separate       | 绑定/分离     | view/browse         | 查看/浏览  |
| edit/modify         | 编辑/修改     | select/mark         | 选取/标记  |
| copy/paste          | 复制/粘贴     | undo/redo           | 撤销/重做  |
| insert/delete       | 插入/移除     | add/append          | 加入/添加  |
| clean/clear         | 清理/清除     | index/sort          | 索引/排序  |
| find/search         | 查找/搜索     | increase/decrease   | 增加/减少  |
| play/pause          | 播放/暂停     | launch/run          | 启动/运行  |
| compile/execute     | 编译/执行     | debug/trace         | 调试/跟踪  |
| observe/listen      | 观察/监听     | build/publish       | 构建/发布  |
| input/output        | 输入/输出     | encode/decode       | 编码/解码  |
| encrypt/decrypt     | 加密/解密     | compress/decompress | 压缩/解压缩|
| pack/unpack         | 打包/解包     | parse/emit          | 解析/生成  |
| connect/disconnect  | 连接/断开     | sent/receive        | 发送/接收  |
| download/upload     | 下载/上传     | refresh/synchronize | 刷新/同步  |
| update/revert       | 更新/复原     | lock/unlock         | 锁定/解锁  |
| check out/check in  | 签出/签入     | submit/commit       | 提交/交付  |
| push/pull           | 推/拉         | expand/collapse     | 展开/折叠  |
| begin/end           | 起始/结束     | start/finish        | 开始/完成  |
| enter/exit          | 进入/退出     | abort/quit          | 放弃/离开  |
| obsolete/depreciate | 废弃/废旧     | collect/aggregate   | 收集/聚集  |
  3. 不推荐构造超长函数，当函数超过100行，就要想想是否能将函数拆为两个或多个函数
  4. 函数调用返回的错误信息，统一使用变量ex（exception）或者err（error）对其进行定义
  5. 一个函数的参数控制在6个以内

## 4 注释<h2 id="4"></h2>

### 4.1 注释内容<h3 id="4.1"></h3>

  1. JS文件开头注释
    [建议]JavaScript文件在开头应包含类似以下注释说明，修改人、修改时间及修改描述这三项要实时更新，保证为最新
```javascript
/*
*@fileName:文件名
*@fileDesc:文件功能描述
*@author:创建人
*@createTime:创建时间
*@modifiedBy:修改人
*@modifiedTime:修改时间
*@modifiedDesc:修改描述
*/
```
  2. 大功能区注释
    [建议]在大功能区（或难以理解的部分）代码的开头添加注释，对其功能、参数及返回值进行描述*（具体详见JSDOC注释规范）*
```javascript
/*
*@desc:功能描述
*@param:参数描述
*@return:返回值
*/
```
  3. 单行注释
    [建议]放在行末尾，对该行代码进行说明，//后面跟一个空格再跟注释内容
```javascript
// 注释内容
```
  4. 特殊标记
    * *（具体详见JSDOC注释规范）*
    * TODO：有功能待实现，此时需要对将要实现的功能进行简单说明
    * FIXME：该处代码运行没问题，但可能由于时间赶或其他原因，需要修正，此时需要对如何修正进行简单说明
    * HACK：为修正某些问题而写的不太好或者使用了某些诡异手段的代码，此时需要对思路或诡异手段进行描述
    * XXX：该处存在陷阱，此时需要对陷阱进行描述
  5. 其他注释说明
    * *（具体详见JSDOC注释规范）*
    * 命名空间注释使用@namespace
    * 类或构造函数注释使用@class
    * 类的继承信息注释使用@extends
    * 使用包装方式扩展类成员时，通过@lends进行重新指向
    * 类的属性或方法等成员信息使用@public/@protected/@private中的任意一个，指明可访问性。当函数是内部函数，外部不可访问时，可以使用@inner标识。重写父类方法时，应当添加@override标识
    * 事件注释使用@event，事件参数的标识与方法描述的参数相同
    * 常量注释使用@const，并包含说明和类型信息
    * 对于类型未定义的复杂结构的注释，可以使用@typeof标识来定义
    * AMD模块使用@module或@exports标识，对于已使用@moudle标识为AMD模块的引用，在namepaths中必须增加"moudle:"作为前缀（若namepaths没有前缀，则生成的文档中将无法正确生成链接）

### 4.2 注释规范<h3 id="4.2"></h3>

  1. 在对函数进行声明时，应用JSDOC对其进行相应的注释说明
  2. 注释应该是解释为什么和做什么，而不是介绍是什么
  3. 总是使注释保持最新
  4. 变量声明时，使用行尾注释，其他情况下，使用单行注释并于标识的代码对齐
  5. 不注释难以理解的代码，而应该重写它
  6. 避免多余的或不适当的注释
  7. 对由循环和逻辑分支组成的代码使用注释
  8. 使用具有一致的风格和语言书写注释
  9. 用空白将注释同注释分隔符分开。在没有颜色提示的情况下查看注释时，这样做会使注释很明显且容易被找到

## 5 其他注意事项<h2 id="5"></h2>

  1. 善于使用IDEA自带的一些功能操作使代码布局更加美观
  2. 总是检查数据，要检查你的方法输入的所有数据，一方面是为了安全性，另一方面是为了可用性
  3. 部署前需要压缩JavaScript文件
  4. 在方法顶端定义所有变量，在大部分情况下var语句应该为方法体内的第一个语句
  5. 尽量少使用全局变量，隐式的全局变量应该从来不使用，同时也应尽量避免全局函数的使用
  6. 代码结构应该提供最好的可读性
  7. 不要在命名中使用里使用$，把它留给JQuery，也不要使用反斜杠（/）
  8. 在每个简单语句末尾添加一个;(分号)
  9. 谨慎使用逗号操作符，一般包括在for语句的控制部分的、对象字面量、数组字面量、var语句和参数列表
  10. 不要在if和while语句块中对条件部分赋值
  11. 避免与null进行比较
  12. 始终使用===和!==操作符会更好，==和!=操作符会做类型强制转换
  13. 不要使用===来和假值做比较，if(obj)一般都可以达到目的
  14. 注意不要在+后面跟+或++。这种模式令人混淆
  15. eval方法是JavaScript里最易滥用的特性。除非解析JSON数据，否则不要使用它
  16. 为了避免混乱，在HTML中使用双引号，在JavaScript中使用单引号
  17. 不要为了偷懒而省略引号和{}
  18. 当需要缓存this时需要使用self变量（也可以是其他变量，例如obj、widget等）进行缓存
  19. 如果针对的是不断运行的代码，不应该使用setTimeout，而应该是用setInterval，因为setTimeout每一次都会初始化一个定时器，而setInterval只会在开始的时候初始化一个定时器
  20. 删除dom节点之前，一定要删除注册在该节点上的事件，否则将会产生无法回收的内存。另外，在removeChild和innerHTML = ''二者之间，尽量选择后者，因为前者无法有效地释放dom节点
  21. 在JavaScript中，我们可以使用for(;;)、while()、for(in)三种循环，事实上，这三种循环中for(in)的效率极差，尽量使用for(;;)循环和while()循环，其中while()循环效率最好

*本规范文档将不断修改更新，请各位批评指正*
